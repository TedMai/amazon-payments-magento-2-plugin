

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Order &amp; payment workflow &mdash; Amazon Pay for Magento 2 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Amazon Pay for Magento 2 1.0.0 documentation" href="index.html"/>
        <link rel="next" title="Frontend Customisation" href="customisation.html"/>
        <link rel="prev" title="Login with Amazon" href="login.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Amazon Pay for Magento 2
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="login.html">Login with Amazon</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Order &amp; payment workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#amazon-pay-button-button"><cite>Amazon Pay button</cite> button</a></li>
<li class="toctree-l2"><a class="reference internal" href="#placing-an-order">Placing an order</a></li>
<li class="toctree-l2"><a class="reference internal" href="#payment-authorization">Payment authorization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synchronous">Synchronous</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asynchronous">Asynchronous</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#payment-capture">Payment capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#payment-refund">Payment refund</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="customisation.html">Frontend Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing your integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Amazon Pay for Magento 2</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Order &amp; payment workflow</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/flow.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="order-payment-workflow">
<h1>Order &amp; payment workflow<a class="headerlink" href="#order-payment-workflow" title="Permalink to this headline">¶</a></h1>
<div class="section" id="amazon-pay-button-button">
<h2><cite>Amazon Pay button</cite> button<a class="headerlink" href="#amazon-pay-button-button" title="Permalink to this headline">¶</a></h2>
<p>The <cite>Amazon Pay</cite> button appears in several places in the shop</p>
<ul class="simple">
<li>on the shipping step of checkout</li>
<li>on the cart page</li>
<li>on the minibasket</li>
<li>on product pages depending on <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a></li>
</ul>
<p>Pressing the <cite>Amazon Pay</cite> button launches the Amazon authentication window, where the customer is asked for their Amazon user account credentials.</p>
<img alt="_images/sign-in.png" src="_images/sign-in.png" />
<p>After a successful login the customer is redirected to the checkout</p>
</div>
<div class="section" id="placing-an-order">
<h2>Placing an order<a class="headerlink" href="#placing-an-order" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Amazon Pay</strong> checkout uses the standard Magento 2 checkout however it replaces certain forms with widgets that populate the data the forms would have requested.</p>
<p>On the shipping step of checkout the address form is replaced with a shipping widget</p>
<img alt="_images/shipping-widget.png" src="_images/shipping-widget.png" />
<p>On the payment step of checkout payment methods are replaced by a payment widget</p>
<img alt="_images/payment-widget.png" src="_images/payment-widget.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In instances where the billing address is not exposed such as within the US region the shipping address will be used to populate the billing address</p>
</div>
<p>The actual order flow other than this remains the same, as it is for the standard Magento 2 checkout.</p>
</div>
<div class="section" id="payment-authorization">
<h2>Payment authorization<a class="headerlink" href="#payment-authorization" title="Permalink to this headline">¶</a></h2>
<p>An authorization is automatically requested on order placement there are 3 authorization flows, Synchronous, Asynchronous and a combination of both as defined in <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a>.</p>
<div class="section" id="synchronous">
<h3>Synchronous<a class="headerlink" href="#synchronous" title="Permalink to this headline">¶</a></h3>
<p>The customer will get instant feedback there are 3 possible outcomes</p>
<ol class="arabic simple">
<li><cite>Authorization OK</cite> - Order is placed with a state of <cite>Processing</cite>, Customer is redirected to the standard Magento 2 confirmation screen</li>
<li><cite>Soft Decline</cite> - Order is not placed and customer is asked to select an alternative payment instrument from the Amazon Pay widget</li>
<li><cite>Hard Decline</cite> - Order is not placed, the Amazon Pay specific checkout will be left (widgets are replaced by standard forms) and the customer is asked to select an alternative payment method for this order</li>
</ol>
</div>
<div class="section" id="asynchronous">
<h3>Asynchronous<a class="headerlink" href="#asynchronous" title="Permalink to this headline">¶</a></h3>
<p>Orders placed when in Asychronous mode should always complete as if authorization was OK however they will be in a <cite>Pending</cite> state with a <cite>Payment Review</cite> status.</p>
<p>The customer will always be redirected to the standard Magento 2 confirmation screen as authorization state will be processed by Amazon Pay after the order is placed.</p>
<p>A status update on the state of the authorization will be delivered by IPN or Cron depending on <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a> there are 3 possible outcomes of this process</p>
<ol class="arabic simple">
<li><cite>Authorization OK</cite> - Order moves to state <cite>Processing</cite></li>
<li><cite>Soft Decline</cite> - Authorization is closed, customer is emailed with a link to select an alternative payment instrument on the Amazon Pay website. When the customer changes the payment instrument, a new authorization is raised</li>
<li><cite>Hard Decline</cite> - Authorization is closed, customer is emailed with instructions to contact the merchant</li>
</ol>
</div>
</div>
<div class="section" id="payment-capture">
<h2>Payment capture<a class="headerlink" href="#payment-capture" title="Permalink to this headline">¶</a></h2>
<p>Orders placed when in <cite>Charge on Order</cite> mode will automatically be captured. For orders placed using <cite>Charge on Shipment</cite> you will need to raise an invoice. To do this, the following steps are required:</p>
<ol class="arabic simple">
<li>Login to the Magento 2 admin</li>
<li>Open the order for which you want to capture payment and click the <cite>Invoice</cite> link located in the top row. Please make sure that the payment you want to capture has an open authorization transaction and is in the <cite>Processing</cite> state.</li>
<li>Submit the invoice form ensuring the <cite>Capture Online</cite> option above the <cite>Submit Invoice</cite> button is selected</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is vital that <cite>Capture Online</cite> is selected as otherwise Amazon Pay will not be instructed to capture the payment, resulting in you not receiving any funds.</p>
</div>
<p>In case there is a problem taking the payment, a notification will be added to Magento 2 to make you aware there has been a problem.</p>
</div>
<div class="section" id="payment-refund">
<h2>Payment refund<a class="headerlink" href="#payment-refund" title="Permalink to this headline">¶</a></h2>
<p>The order, which payment has been captured for, can be refunded either fully or partially. Refunds are made against invoices and thus having a paid invoice assigned to the order is a necessary condition that has to be met to refund any order item.</p>
<p>Refunds in Magento 2 are recorded as credit memos, so for requesting a refund with Amazon Pay you should create a credit memo first. To create a credit memo login to the Magento 2 admin, open the order you want refund, click <cite>Invoices</cite> tab on the left, select an invoice you want to refund and click on it.</p>
<p>A preview of the selected invoice will appear. Make sure that you are on the single invoice preview page and click the <cite>Credit Memo</cite> button.</p>
<p>A new credit memo form will appear with most of the crucial data (like product quantities to be refunded) already filled in.</p>
<p>If you want to refund the invoice partially (i.e. only a part of the invoiced items) adjust the product quantities to be refunded (set 0 for items that shall not be refunded) and click <cite>Update Qty&#8217;s</cite> button to update refund totals. You can also set the refunded items back to stock by checking <cite>Return to Stock</cite> checkbox.</p>
<p>Next choose if you want to refund shipping costs or apply any refund adjustments and fill in the appropriate fields. Before submitting the credit memo form, double check that you have <cite>Refund</cite> button available and click it. A credit memo will be created and a refund will be requested with Amazon Pay.</p>
<p>Refunds will always be initially accepted as the vast majority of the time there will be no issue. However, if there is a problem after the refund has been issued, a notification will be added to Magento 2 to make you aware there has been a problem refunding the customer.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Always use the <cite>Refund</cite> button available on the new credit memo form invoked from the single invoice preview page. If you click <cite>Credit Memo</cite> button directly on the order page you will be redirected to the new credit memo form with <cite>Refund offline</cite> button only, which will appear to be successful. However it will not notify Amazon Pay and the customer will not receive their refund.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="customisation.html" class="btn btn-neutral float-right" title="Frontend Customisation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="login.html" class="btn btn-neutral" title="Login with Amazon" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Amazon.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>